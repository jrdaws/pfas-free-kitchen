TASK: Integration Tests for Configurator Optimization Features
PRIORITY: P1 (Critical - New Features Need Testing)
TYPE: Testing / Integration / E2E
AGENT: Testing Agent

---

## Objective

Create integration tests for the 6 new optimization features deployed today.
Ensure all new APIs, components, and flows work correctly.

## Features to Test

### 1. Vision Builder (Website Agent)

Test files: `website/app/components/configurator/vision/`

Tests needed:
- [ ] VisionBuilder renders all steps
- [ ] ProblemStep captures and validates input
- [ ] AudienceStep selection works (B2B/B2C/etc)
- [ ] BusinessModelStep card selection
- [ ] DesignStyleStep image grid selection
- [ ] FeatureDiscovery shows relevant features
- [ ] VisionSummary displays collected data
- [ ] VisionDocument is properly structured

### 2. Multi-Page Preview (Platform Agent)

Test files: 
- `website/app/api/preview/session/route.ts`
- `website/app/api/preview/page/[pageId]/route.ts`

Tests needed:
- [ ] POST /api/preview/session creates session
- [ ] Session includes shared state
- [ ] GET /api/preview/page/[pageId] returns page content
- [ ] Navigation between pages maintains context
- [ ] Preview respects user's color scheme
- [ ] Personalized props use research insights

### 3. Context Memory (Platform Agent)

Test files:
- `website/app/api/context/session/route.ts`
- `website/app/api/context/session/[id]/route.ts`
- `website/app/api/context/session/[id]/learn/route.ts`

Tests needed:
- [ ] POST /api/context/session creates context
- [ ] PATCH /api/context/session/[id] updates context
- [ ] Context accumulates across interactions
- [ ] POST /api/context/session/[id]/learn stores corrections
- [ ] Corrections apply to future generations
- [ ] Context persists across page refreshes

### 4. Output Validation (Quality Agent)

Test files:
- `scripts/lib/fidelity-scorer.ts`
- `scripts/lib/compatibility-matrix.ts`

Tests needed:
- [ ] Fidelity scorer compares preview to export
- [ ] Color match scoring works
- [ ] Component match detection works
- [ ] Compatibility matrix identifies conflicts
- [ ] Integration conflicts are flagged (e.g., Supabase + Clerk auth)

### 5. Feedback Collection (Quality Agent)

Test files:
- `website/app/api/feedback/export/route.ts`

Tests needed:
- [ ] POST /api/feedback/export accepts feedback
- [ ] Feedback links to project configuration
- [ ] Rating validation (1-5 stars)
- [ ] Text feedback stored correctly

### 6. Quality Dashboard (Quality Agent)

Test files:
- `website/app/admin/quality-dashboard/page.tsx`
- `website/app/api/admin/quality-metrics/route.ts`

Tests needed:
- [ ] Dashboard page renders
- [ ] Metrics API returns data
- [ ] Charts display correctly
- [ ] Admin auth required (if implemented)

## Test File Locations

Create tests in:
```
website/tests/
├── vision-builder.spec.ts
├── preview-session.spec.ts
├── context-memory.spec.ts
├── feedback-collection.spec.ts
└── quality-dashboard.spec.ts

tests/
├── fidelity-scorer.test.mjs
└── compatibility-matrix.test.mjs
```

## Success Criteria

- [ ] All 6 feature areas have tests
- [ ] Tests pass locally
- [ ] No regressions in existing tests
- [ ] Coverage report shows new code tested

## References

- Vision Builder: website/app/components/configurator/vision/
- Preview: website/lib/preview/session-store.ts
- Context: website/lib/context/
- Quality: scripts/lib/fidelity-scorer.ts

