# TASK: Add Image Generation to All Pattern Components

**Priority**: P0
**Wave**: 1 (Parallel)
**Assigned To**: Website Agent
**Estimated Effort**: 3-4 hours
**Dependencies**: None

---

## Objective

Wire up the existing image generation API (`/api/generate/image`) to ALL pattern components that display images. Currently only the Hero component generates images. Users should see AI-generated images throughout their entire preview.

---

## Current State

- Image generation works via `/api/generate/image` endpoint
- Uses Replicate API with FLUX model
- Hero sections generate images ✅
- Other sections show placeholders ❌

---

## Components Needing Image Generation

### 1. FeaturesIconGrid (`features-icon-grid`)
**Location**: `website/lib/patterns/patterns/features/icon-grid-3col.tsx`

**Image Slots**:
- `feature.image` - Custom illustration for each feature (3-6 images)

**Prompt Strategy**:
```
Feature icon for [feature.title]: [feature.description]
Style: minimal icon illustration, flat design, single color accent
Size: 256x256, transparent background style
```

### 2. FeaturesBentoGrid (`features-bento`)
**Location**: `website/lib/patterns/patterns/features/bento-grid.tsx`

**Image Slots**:
- `feature.image` - Abstract illustration per feature (4-6 images)

**Prompt Strategy**:
```
Abstract illustration for [feature.title]
Style: modern gradient, geometric shapes, tech aesthetic
Size: 512x512
```

### 3. TestimonialCards (`testimonials-grid`)
**Location**: `website/lib/patterns/patterns/social-proof/TestimonialCards.tsx`

**Image Slots**:
- `testimonial.author.avatar` - Professional headshot per testimonial (2-4 images)

**Prompt Strategy**:
```
Professional headshot of [author.name], [author.title] at [author.company]
Style: natural lighting, friendly expression, business casual, neutral background
Size: 256x256, portrait
```

### 4. LogoWall (`logos-simple`)
**Location**: `website/lib/patterns/patterns/social-proof/LogoWall.tsx`

**Image Slots**:
- `logo.src` - Stylized placeholder logos (4-8 images)

**Prompt Strategy**:
```
Minimalist company logo placeholder, abstract geometric mark
Style: single color, simple shape, professional, tech company aesthetic
Size: 200x80, transparent/dark background
```

### 5. PricingTable3Tier (`pricing-three-tier`)
**Location**: `website/lib/patterns/patterns/pricing/PricingTable3Tier.tsx`

**No images needed** - Text-focused component ✅

### 6. CTASection (`cta-simple`)
**Location**: `website/lib/patterns/patterns/cta/CTASection.tsx`

**Image Slots**:
- `backgroundImage` (optional) - Abstract background for gradient-bg variant

**Prompt Strategy**:
```
Abstract gradient background, flowing shapes, brand colors
Style: dark theme, subtle glow, professional
Size: 1920x600
```

### 7. FAQAccordion (`faq-accordion`)
**Location**: `website/lib/patterns/patterns/faq/FAQAccordion.tsx`

**No images needed** - Text-focused component ✅

### 8. ProductGrid (if exists for ecommerce)
**Image Slots**:
- `product.image` - Product photography style images

**Prompt Strategy**:
```
Product photo of [product.name], e-commerce style
Style: white/neutral background, professional lighting, centered
Size: 512x512
```

---

## Implementation Approach

### Option A: Generate on Compose (Recommended)
Add image generation to the compose API flow when sections are created.

**File**: `website/app/api/compose/project/route.ts`

Add after section selection:
```typescript
// For each section, check if it needs images
for (const section of composition.sections) {
  if (section.patternId === 'features-icon-grid') {
    // Generate feature icons
    for (const feature of section.props.features) {
      if (!feature.image) {
        feature.image = await generateImage({
          prompt: `Feature icon: ${feature.title}`,
          size: '256x256',
        });
      }
    }
  }
  // ... similar for other patterns
}
```

### Option B: Generate on Demand in Preview
Add a "Generate Images" button per section in the preview.

**File**: `website/components/preview/SectionRenderer.tsx`

Add:
```tsx
{editable && needsImages(section) && (
  <button onClick={() => generateSectionImages(section)}>
    ✨ Generate Images
  </button>
)}
```

---

## Image Generation Helper

Create a centralized helper:

**File**: `website/lib/patterns/image-generator.ts`

```typescript
import { generateImage } from '@/lib/image/index';

export async function generatePatternImages(
  patternId: string,
  props: Record<string, unknown>,
  context: { projectName: string; domain: string }
): Promise<Record<string, unknown>> {
  switch (patternId) {
    case 'features-icon-grid':
      return generateFeatureImages(props, context);
    case 'testimonials-grid':
      return generateTestimonialAvatars(props, context);
    case 'logos-simple':
      return generateLogoPlaceholders(props, context);
    // ... more patterns
    default:
      return props;
  }
}

async function generateFeatureImages(props, context) {
  const features = props.features || [];
  const enhanced = await Promise.all(
    features.map(async (feature, i) => {
      if (!feature.image) {
        const image = await generateImage({
          prompt: `Minimal icon illustration for ${feature.title}: ${feature.description}. Style: flat design, single accent color on dark background, modern tech aesthetic`,
        });
        return { ...feature, image };
      }
      return feature;
    })
  );
  return { ...props, features: enhanced };
}
```

---

## Success Criteria

- [ ] Features sections show generated illustrations (not placeholder icons)
- [ ] Testimonials show generated avatar headshots
- [ ] Logo wall shows stylized placeholder logos
- [ ] Images are cached to avoid regeneration
- [ ] Generation is throttled (max 3 concurrent)
- [ ] Loading states shown during generation
- [ ] Total generation time < 30 seconds for full page

---

## Testing

1. Create new project in configurator
2. Complete research step
3. Check preview - all sections should have real images
4. Images should match the domain/industry
5. Regenerate button should work

---

## Rate Limiting Considerations

- Replicate API has rate limits
- Queue image generation requests
- Show progress: "Generating 3 of 8 images..."
- Allow partial completion (some images, some placeholders)

---

*Created by Documentation Agent*

