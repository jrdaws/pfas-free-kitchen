# TASK: Add New Section Panel

**Priority**: P1
**Wave**: 4 (After Wave 3)
**Assigned To**: Website Agent
**Estimated Effort**: 3 hours
**Dependencies**: WAVE2-B-pattern-swapping-ui.txt

---

## Objective

Create a panel that allows users to add new sections to their page. Show available patterns by category with previews, and insert the selected pattern at the chosen position.

---

## Current State

- Pattern registry has all patterns categorized
- No UI to add new sections
- Sections can only come from initial composition

---

## Implementation

### 1. Add Section Button

Show between sections and at the end:

**File**: `website/components/preview/AddSectionButton.tsx`

```tsx
'use client';

interface AddSectionButtonProps {
  onClick: () => void;
  position: 'between' | 'end';
}

export function AddSectionButton({ onClick, position }: AddSectionButtonProps) {
  return (
    <div
      className={`relative py-4 group ${
        position === 'between' ? 'my-0' : 'mt-8'
      }`}
    >
      {/* Dashed line */}
      <div className="absolute inset-x-0 top-1/2 -translate-y-1/2 h-px bg-dashed bg-white/10" />

      {/* Add button */}
      <button
        onClick={onClick}
        className="relative left-1/2 -translate-x-1/2 flex items-center gap-2 px-4 py-2 bg-slate-800 hover:bg-slate-700 border border-white/10 rounded-lg text-sm text-white transition-all hover:scale-105"
      >
        <PlusIcon className="w-4 h-4" />
        Add Section
      </button>
    </div>
  );
}

function PlusIcon({ className }: { className?: string }) {
  return (
    <svg className={className} fill="none" viewBox="0 0 24 24" stroke="currentColor">
      <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 4v16m8-8H4" />
    </svg>
  );
}
```

### 2. Section Picker Modal

**File**: `website/components/preview/SectionPickerModal.tsx`

```tsx
'use client';

import { useState } from 'react';
import { getAllPatterns, getPatternsByCategory } from '@/lib/patterns/registry';
import type { PatternDefinition, PatternCategory } from '@/lib/patterns/types';

interface SectionPickerModalProps {
  isOpen: boolean;
  onClose: () => void;
  onSelect: (patternId: string) => void;
}

const CATEGORIES: { id: PatternCategory; label: string; emoji: string }[] = [
  { id: 'hero', label: 'Hero', emoji: 'üåü' },
  { id: 'features', label: 'Features', emoji: '‚ú®' },
  { id: 'social-proof', label: 'Social Proof', emoji: 'üí¨' },
  { id: 'pricing', label: 'Pricing', emoji: 'üí∞' },
  { id: 'cta', label: 'Call to Action', emoji: 'üì¢' },
  { id: 'faq', label: 'FAQ', emoji: '‚ùì' },
];

export function SectionPickerModal({
  isOpen,
  onClose,
  onSelect,
}: SectionPickerModalProps) {
  const [activeCategory, setActiveCategory] = useState<PatternCategory>('hero');
  const [searchQuery, setSearchQuery] = useState('');

  if (!isOpen) return null;

  const patterns = searchQuery
    ? getAllPatterns().filter(
        (p) =>
          p.name.toLowerCase().includes(searchQuery.toLowerCase()) ||
          p.description?.toLowerCase().includes(searchQuery.toLowerCase())
      )
    : getPatternsByCategory(activeCategory);

  return (
    <div className="fixed inset-0 z-50 flex items-center justify-center">
      {/* Backdrop */}
      <div className="absolute inset-0 bg-black/70" onClick={onClose} />

      {/* Modal */}
      <div className="relative bg-slate-900 rounded-2xl w-full max-w-4xl max-h-[80vh] flex overflow-hidden border border-white/10">
        {/* Sidebar */}
        <div className="w-48 border-r border-white/10 p-4 flex-shrink-0">
          <h2 className="text-lg font-semibold text-white mb-4">Add Section</h2>

          {/* Search */}
          <div className="relative mb-4">
            <input
              type="text"
              placeholder="Search..."
              value={searchQuery}
              onChange={(e) => setSearchQuery(e.target.value)}
              className="w-full px-3 py-2 bg-slate-800 border border-white/10 rounded-lg text-sm text-white placeholder:text-white/40"
            />
          </div>

          {/* Categories */}
          <nav className="space-y-1">
            {CATEGORIES.map((cat) => (
              <button
                key={cat.id}
                onClick={() => {
                  setActiveCategory(cat.id);
                  setSearchQuery('');
                }}
                className={`w-full flex items-center gap-2 px-3 py-2 rounded-lg text-sm transition-colors ${
                  activeCategory === cat.id && !searchQuery
                    ? 'bg-orange-500/20 text-orange-400'
                    : 'text-white/60 hover:text-white hover:bg-white/5'
                }`}
              >
                <span>{cat.emoji}</span>
                {cat.label}
              </button>
            ))}
          </nav>
        </div>

        {/* Pattern grid */}
        <div className="flex-1 p-6 overflow-y-auto">
          <div className="grid grid-cols-2 gap-4">
            {patterns.map((pattern) => (
              <PatternCard
                key={pattern.id}
                pattern={pattern}
                onSelect={() => {
                  onSelect(pattern.id);
                  onClose();
                }}
              />
            ))}
          </div>

          {patterns.length === 0 && (
            <div className="text-center py-12">
              <p className="text-white/40">No patterns found</p>
            </div>
          )}
        </div>

        {/* Close button */}
        <button
          onClick={onClose}
          className="absolute top-4 right-4 p-2 hover:bg-white/5 rounded-lg"
        >
          <XIcon className="w-5 h-5 text-white/60" />
        </button>
      </div>
    </div>
  );
}

function PatternCard({
  pattern,
  onSelect,
}: {
  pattern: PatternDefinition;
  onSelect: () => void;
}) {
  return (
    <button
      onClick={onSelect}
      className="group relative bg-slate-800/50 hover:bg-slate-800 border border-white/5 hover:border-orange-500/50 rounded-xl overflow-hidden transition-all"
    >
      {/* Pattern preview/thumbnail */}
      <div className="aspect-video bg-gradient-to-br from-slate-700 to-slate-800 flex items-center justify-center">
        <span className="text-4xl">{pattern.thumbnail || 'üìê'}</span>
      </div>

      {/* Pattern info */}
      <div className="p-3">
        <p className="text-sm font-medium text-white group-hover:text-orange-400 transition-colors">
          {pattern.name}
        </p>
        <p className="text-xs text-white/40 mt-0.5 line-clamp-2">
          {pattern.description}
        </p>
      </div>

      {/* Hover overlay */}
      <div className="absolute inset-0 bg-orange-500/0 group-hover:bg-orange-500/10 transition-colors flex items-center justify-center opacity-0 group-hover:opacity-100">
        <span className="px-3 py-1.5 bg-orange-500 text-white text-sm font-medium rounded-lg">
          Add Section
        </span>
      </div>
    </button>
  );
}

function XIcon({ className }: { className?: string }) {
  return (
    <svg className={className} fill="none" viewBox="0 0 24 24" stroke="currentColor">
      <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M6 18L18 6M6 6l12 12" />
    </svg>
  );
}
```

### 3. Integrate with Preview

**File**: Update `website/components/preview/DynamicPreviewRenderer.tsx`

```tsx
export function DynamicPreviewRenderer({
  definition,
  editable,
  onDefinitionChange,
  // ...
}: DynamicPreviewRendererProps) {
  const [pickerOpen, setPickerOpen] = useState(false);
  const [insertIndex, setInsertIndex] = useState(0);

  const handleAddSection = (patternId: string) => {
    const newSection: SectionConfig = {
      id: `section-${Date.now()}`,
      patternId,
      variantId: undefined,
      props: {},
    };

    const page = definition.pages[0];
    const newSections = [...page.sections];
    newSections.splice(insertIndex, 0, newSection);

    onDefinitionChange?.({
      ...definition,
      pages: [
        {
          ...page,
          sections: newSections,
        },
        ...definition.pages.slice(1),
      ],
    });
  };

  return (
    <>
      {page.sections.map((section, index) => (
        <React.Fragment key={section.id}>
          {editable && (
            <AddSectionButton
              position="between"
              onClick={() => {
                setInsertIndex(index);
                setPickerOpen(true);
              }}
            />
          )}
          <SectionRenderer section={section} ... />
        </React.Fragment>
      ))}

      {editable && (
        <AddSectionButton
          position="end"
          onClick={() => {
            setInsertIndex(page.sections.length);
            setPickerOpen(true);
          }}
        />
      )}

      <SectionPickerModal
        isOpen={pickerOpen}
        onClose={() => setPickerOpen(false)}
        onSelect={handleAddSection}
      />
    </>
  );
}
```

---

## Pattern Thumbnails

Each pattern should have a thumbnail image or emoji. Options:

1. **Emoji** (current): Quick, no asset management
2. **Screenshot**: Auto-generated from rendered pattern
3. **Illustration**: Hand-crafted preview images

For MVP, use emoji/icon thumbnails. Can upgrade to screenshots later.

---

## Success Criteria

- [ ] "Add Section" buttons appear between sections
- [ ] Clicking opens section picker modal
- [ ] Categories filter patterns correctly
- [ ] Search finds patterns by name/description
- [ ] Selecting pattern inserts at correct position
- [ ] New section has default props
- [ ] Modal closes after selection

---

## Testing

1. Open preview in editable mode
2. Click "Add Section" between hero and features
3. Select "Pricing" category
4. Click "3-Tier Pricing"
5. Pricing section appears at that position

---

*Created by Documentation Agent*

