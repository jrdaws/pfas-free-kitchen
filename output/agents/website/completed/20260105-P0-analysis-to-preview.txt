TASK: Apply Website Analysis to Preview Generation
PRIORITY: P0 (Uses Wave 1 Output)
TYPE: Frontend / Preview
AGENT: Website Agent
PARALLEL: No - Wave 2 (After Deep Analysis)

---

## Objective

Use the website analysis from Wave 1 to generate a preview that MATCHES
the inspiration site's structure, style, and features.

---

## What the Preview Should Match

When a user provides "https://example-pet-store.com" as inspiration:

1. **Structure Match**: If their site has Hero → Features → Testimonials → Pricing → CTA
   → Our preview should have the SAME section order

2. **Style Match**: If their buttons are pill-shaped gradients
   → Our preview buttons should be pill-shaped gradients

3. **Color Match**: If their site uses #2D5A27 green and #F5E6D3 cream
   → Our preview should use those colors

4. **Feature Match**: If their site has a shopping cart
   → Our preview should show a shopping cart component

---

## Implementation

### 1. Structure-Aware Composition

Update the composer to use detected structure:

```typescript
// website/lib/composer/index.ts

export async function composeProject(input: ComposerInput): Promise<ComposerOutput> {
  const { websiteAnalysis } = input;
  
  // If we have analysis, use IT to determine sections
  if (websiteAnalysis?.structure?.sections) {
    const pages = websiteAnalysis.structure.sections.map(section => ({
      patternId: mapSectionToPattern(section.type, section.layout),
      order: section.position,
      config: {
        hasImage: section.hasImage,
        hasVideo: section.hasVideo,
        height: section.estimatedHeight,
      },
    }));
    
    return {
      composition: { pages },
      // ...
    };
  }
  
  // Fallback to AI selection
  return await aiSelectPatterns(input);
}

function mapSectionToPattern(type: string, layout: string): string {
  const mapping: Record<string, Record<string, string>> = {
    hero: {
      centered: 'hero-centered',
      split: 'hero-split-image',
      grid: 'hero-with-cards',
    },
    features: {
      grid: 'features-grid',
      list: 'features-alternating',
      centered: 'features-centered',
    },
    // ... map all section types to patterns
  };
  
  return mapping[type]?.[layout] || 'generic-section';
}
```

### 2. Style-Aware Components

Apply detected component styles:

```typescript
// website/components/preview/StyledButton.tsx

interface StyledButtonProps {
  children: React.ReactNode;
  componentStyle?: DetectedComponents['buttons'];
}

export function StyledButton({ children, componentStyle }: StyledButtonProps) {
  const classes = cn(
    'px-4 py-2',
    // Apply detected shape
    componentStyle?.shape === 'pill' && 'rounded-full',
    componentStyle?.shape === 'rounded' && 'rounded-lg',
    componentStyle?.shape === 'square' && 'rounded-none',
    // Apply detected style
    componentStyle?.style === 'gradient' && 'bg-gradient-to-r from-primary to-secondary',
    componentStyle?.style === 'outline' && 'border-2 border-primary bg-transparent',
    componentStyle?.style === 'solid' && 'bg-primary text-white',
  );
  
  return <button className={classes}>{children}</button>;
}
```

### 3. Color Application

Apply extracted colors as CSS variables:

```typescript
// website/components/preview/ComposedPreview.tsx

function ComposedPreview({ composition, websiteAnalysis }: Props) {
  const colors = websiteAnalysis?.visual?.colors;
  
  const colorStyles = colors ? {
    '--preview-primary': colors.primary,
    '--preview-secondary': colors.secondary,
    '--preview-accent': colors.accent,
    '--preview-background': colors.background,
    '--preview-foreground': colors.foreground,
    '--preview-muted': colors.muted,
  } : {};
  
  return (
    <div style={colorStyles} className="preview-container">
      {/* Preview content uses these CSS variables */}
    </div>
  );
}
```

### 4. Typography Application

Apply detected typography:

```typescript
// website/components/preview/PreviewTypography.tsx

const fontMapping = {
  'bold': 'font-bold',
  'light': 'font-light',
  'serif': 'font-serif',
  'display': 'font-display', // Needs to be defined in tailwind config
};

function applyTypography(typography: DetectedComponents['typography']): string {
  return cn(
    fontMapping[typography.headingStyle] || 'font-semibold',
    typography.accentFont && 'tracking-tight',
  );
}
```

### 5. Feature Indicators

Show detected features in preview:

```typescript
// website/components/preview/FeatureBadges.tsx

function FeatureBadges({ features }: { features: DetectedFeatures }) {
  return (
    <div className="flex gap-2">
      {features.auth.hasLogin && <Badge>Auth</Badge>}
      {features.ecommerce.hasCart && <Badge>Cart</Badge>}
      {features.content.hasBlog && <Badge>Blog</Badge>}
      {features.social.hasComments && <Badge>Comments</Badge>}
    </div>
  );
}
```

### 6. Preview Comparison View

Allow user to compare original vs generated:

```typescript
// website/components/preview/ComparisonView.tsx

function ComparisonView({ 
  originalScreenshot, 
  generatedPreview 
}: Props) {
  const [splitPosition, setSplitPosition] = useState(50);
  
  return (
    <div className="comparison-slider">
      <div className="original" style={{ width: `${splitPosition}%` }}>
        <img src={originalScreenshot} alt="Original site" />
        <span>Original</span>
      </div>
      <div className="generated" style={{ width: `${100 - splitPosition}%` }}>
        {generatedPreview}
        <span>Generated</span>
      </div>
      <input
        type="range"
        min={0}
        max={100}
        value={splitPosition}
        onChange={(e) => setSplitPosition(Number(e.target.value))}
      />
    </div>
  );
}
```

---

## Files to Modify

1. `website/lib/composer/index.ts` - Structure-aware composition
2. `website/components/preview/ComposedPreview.tsx` - Apply styles/colors
3. `website/components/preview/PreviewRenderer.tsx` - Pass analysis down

## Files to Create

1. `website/components/preview/StyledButton.tsx`
2. `website/components/preview/StyledCard.tsx`
3. `website/components/preview/ComparisonView.tsx`
4. `website/components/preview/FeatureBadges.tsx`

---

## Success Criteria

- [ ] Preview sections match inspiration structure order
- [ ] Preview colors match inspiration palette
- [ ] Preview components match inspiration style
- [ ] User can compare original vs generated
- [ ] Feature badges show detected features

