# TASK: Implement ProjectDefinition Type System

**Priority**: P0
**Assigned To**: Platform Agent
**Dependencies**: TASK-pattern-library-foundation (Website Agent)
**Estimated Effort**: 3 hours

---

## Objective

Create the `ProjectDefinition` type system that serves as the single source of truth connecting preview rendering to export generation.

---

## Reference Documents

Before starting, read:
- `output/shared/research/PATTERN-SYSTEM-TECHNICAL-SPEC.md` (Part 1: Core Type Definitions)
- `website/lib/generator/types.ts` (existing generator types)
- `website/lib/configurator-state.ts` (current configurator state)

---

## Tasks

### Task 1: Create ProjectDefinition Type

The ProjectDefinition must include:
- `meta` - Project name, description, template, timestamps
- `branding` - Colors, fonts, spacing, border radius, shadows
- `pages[]` - Array of page configurations with sections
- `navigation` - Global nav pattern and props
- `footer` - Global footer pattern and props
- `integrations` - Selected integrations
- `features` - Selected features
- `inspiration` - Source analysis data (optional)

### Task 2: Create Conversion Utilities

Create utilities to convert between existing state and ProjectDefinition:

```typescript
// website/lib/patterns/converters.ts

// Convert current configurator state to ProjectDefinition
export function configStateToDefinition(
  state: ConfiguratorState
): ProjectDefinition;

// Convert ProjectDefinition back to configurator state
export function definitionToConfigState(
  definition: ProjectDefinition
): ConfiguratorState;

// Convert website analysis to partial definition
export function analysisToDefinition(
  analysis: WebsiteAnalysis,
  template: string
): Partial<ProjectDefinition>;
```

### Task 3: Integrate with Generator

Update `website/lib/generator/index.ts` to:
1. Accept `ProjectDefinition` as input
2. Use pattern IDs to generate actual component code
3. Apply branding to generated Tailwind config
4. Ensure export matches preview exactly

### Task 4: Create Definition Builder

Create a builder pattern for constructing definitions:

```typescript
// website/lib/patterns/definition-builder.ts

export class DefinitionBuilder {
  private definition: Partial<ProjectDefinition>;
  
  static fromTemplate(template: string): DefinitionBuilder;
  static fromAnalysis(analysis: WebsiteAnalysis): DefinitionBuilder;
  
  setMeta(meta: ProjectDefinition['meta']): this;
  setBranding(branding: BrandingConfig): this;
  addPage(page: PageConfig): this;
  setSection(pageIndex: number, sectionIndex: number, section: SectionConfig): this;
  setIntegrations(integrations: Record<string, string>): this;
  
  build(): ProjectDefinition;
}
```

### Task 5: Add Validation

Create validation utilities:

```typescript
// website/lib/patterns/validation.ts

export function validateDefinition(
  definition: ProjectDefinition
): { valid: boolean; errors: string[]; warnings: string[] };

export function validateSection(
  section: SectionConfig
): { valid: boolean; errors: string[] };

export function validateBranding(
  branding: BrandingConfig
): { valid: boolean; errors: string[] };
```

---

## Success Criteria

- [ ] ProjectDefinition type is comprehensive and well-documented
- [ ] Converters work bidirectionally without data loss
- [ ] Generator produces valid Next.js code from definitions
- [ ] Validation catches common errors before export
- [ ] Type checking passes with strict mode

---

## Testing

Create test cases:

```bash
cd /Users/joseph.dawson/Documents/dawson-does-framework/website
npm run test -- --grep "ProjectDefinition"
```

Test files:
- `tests/patterns/definition-builder.test.ts`
- `tests/patterns/converters.test.ts`
- `tests/patterns/validation.test.ts`

---

## Handoff

When complete:
1. Update `prompts/agents/memory/PLATFORM_MEMORY.md`
2. Create `output/agents/platform/outbox/project-definition-complete.txt`
3. Notify Website Agent that types are ready for integration

---

*Created by Documentation Agent*

