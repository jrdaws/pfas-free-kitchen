# Implement Tiered Checkpoint System

**Priority**: P1 - Efficiency Improvement
**Approved By**: Auditor Agent
**Date**: 2025-12-25
**Proposal**: `output/agents/documentation/workspace/checkpoint-optimization.md`

---

## Summary

Implement a 3-tier checkpoint system to reduce token overhead by 67-99% while preserving quality for significant work.

---

## âš ï¸ MANDATORY FIRST STEP: Create Backup

**Before modifying ANY files**, archive originals:

```bash
# Create backup directory
mkdir -p docs/archive/checkpoint-v1-backup

# Copy original files
cp docs/sops/CHECKPOINT_SOP.md docs/archive/checkpoint-v1-backup/
cp output/shared/MINDFRAME.md docs/archive/checkpoint-v1-backup/
cp scripts/checkpoint.sh docs/archive/checkpoint-v1-backup/

# Create manifest
cat > docs/archive/checkpoint-v1-backup/MANIFEST.md << 'EOF'
# Checkpoint v1 Backup
**Date**: $(date +%Y-%m-%d)
**Reason**: Pre-tiered-checkpoint-optimization backup

## Files Backed Up
- CHECKPOINT_SOP.md (494 lines)
- MINDFRAME.md (full file)
- checkpoint.sh (original script)

## Restore Command
```bash
cp docs/archive/checkpoint-v1-backup/CHECKPOINT_SOP.md docs/sops/
cp docs/archive/checkpoint-v1-backup/MINDFRAME.md output/shared/
cp docs/archive/checkpoint-v1-backup/checkpoint.sh scripts/
```
EOF

# Verify backups exist
ls -la docs/archive/checkpoint-v1-backup/
```

**DO NOT proceed with Task 1 until backups are confirmed.**

| Tier | Trigger | Token Cost | Use Case |
|------|---------|------------|----------|
| Light | `cp light` | ~100 | Quick fixes < 15 min |
| Standard | `cp` | ~500 | Normal sessions 15-60 min |
| Full | `cp full` | ~2,500 | Major work > 60 min |

---

## Task 1: Update CHECKPOINT_SOP.md

Reduce from 494 lines to ~150 lines.

### Keep (condense):
- Overview (10 lines)
- Tier definitions (30 lines)
- Graceful stop rule (10 lines)
- Simplified memory template (20 lines)
- Confirmation format (10 lines)

### Remove/Move:
- Full 5-category memory template â†’ Move to MEMORY_FORMAT.md
- Cumulative section templates â†’ Move to MEMORY_FORMAT.md
- Detailed SOP scan questions â†’ Monthly review doc
- Verbose examples â†’ Reference doc

### New Structure:

```markdown
# Checkpoint SOP v2.0

## Tiers

| Tier | Trigger | Steps | When |
|------|---------|-------|------|
| Light | `cp light` | Commit + Sign off | < 15 min |
| Standard | `cp` | Test + Commit + Brief memory | 15-60 min |
| Full | `cp full` | All steps | > 60 min / major |

## Light Checkpoint
1. `git add -A && git commit -m "type(scope): desc" && git push`
2. Sign off: `(ROLE AGENT)`

## Standard Checkpoint
1. `npm test` (if code changed)
2. `git add -A && git commit && git push`
3. Brief memory entry (5 lines max)
4. Sign off

## Full Checkpoint
[Current 6-step process]

## Memory Entry (Standard)
```markdown
### Session: [DATE]
- **Work**: [1-2 line summary]
- **Files**: [list]
- **Duration**: [X] min
- **Next**: [handoff or continue]
```

## Full Memory Entry
See: MEMORY_FORMAT.md for 5-category template
```

---

## Task 2: Update MINDFRAME.md Checkpoint Section

Replace lines 134-156 with condensed version:

```markdown
## ðŸ“¦ Checkpoint Protocol

**Trigger**: `cp` (or `cp light` | `cp full`)

| Tier | When | Steps |
|------|------|-------|
| Light | < 15 min | Commit + Sign off |
| Standard | 15-60 min | Test + Commit + Brief memory |
| Full | > 60 min / major | All steps + MINDFRAME + SOP scan |

**Default**: Standard tier

**Full SOP**: `docs/sops/CHECKPOINT_SOP.md`
```

---

## Task 3: Update .cursorrules Session End Section

Current (lines 112-118):
```markdown
## Session End (Tiered - Rec 6)

| Session Type | Required Steps |
|--------------|----------------|
| **Simple** (<30 min) | 1. Commit + push 2. Sign off |
| **Standard** (30+ min) | 1. Commit 2. Brief memory (5 lines) 3. Handoff if needed |
| **Major** (multi-hour) | Full protocol: memory, MINDFRAME, priorities, handoff |
```

Update to align with checkpoint tiers:
```markdown
## Session End / Checkpoint (Tiered)

| Tier | Trigger | Steps |
|------|---------|-------|
| Light | `cp light` | Commit + Sign off |
| Standard | `cp` | Test + Commit + Brief memory |
| Full | `cp full` | All: memory, MINDFRAME, SOP scan, handoff |
```

---

## Task 4: Create Reference Doc for Full Memory Template

Create `prompts/agents/MEMORY_FORMAT.md` with:
- 5-category full template (moved from CHECKPOINT_SOP)
- Cumulative section templates
- When to use each category
- Examples

This keeps detailed templates available for `cp full` without bloating the main SOP.

---

## Task 5: Hand Off to CLI Agent

After documentation updates, create task for CLI Agent to update `scripts/checkpoint.sh`:

```bash
#!/bin/bash
TIER=${2:-standard}  # light, standard, full

case $TIER in
  light)
    git add -A && git commit -m "$MSG" && git push
    ;;
  standard)
    npm test && git add -A && git commit -m "$MSG" && git push
    echo "ðŸ“ Update memory (5 lines max)"
    ;;
  full)
    # Current full process
    ;;
esac
```

---

## Verification

After implementation:

```bash
# Check SOP length
wc -l docs/sops/CHECKPOINT_SOP.md
# Expected: ~150 lines (down from 494)

# Check MINDFRAME section
grep -A 15 "Checkpoint Protocol" output/shared/MINDFRAME.md | wc -l
# Expected: ~12 lines (down from 22)
```

---

## Success Metrics

| Metric | Before | After |
|--------|--------|-------|
| CHECKPOINT_SOP.md | 494 lines | ~150 lines |
| MINDFRAME section | 22 lines | 12 lines |
| Light CP tokens | N/A | ~100 |
| Standard CP tokens | ~7,600 | ~500 |
| Full CP tokens | ~7,600 | ~2,500 |

---

## Deliverables

1. [ ] Updated `docs/sops/CHECKPOINT_SOP.md` (150 lines)
2. [ ] Updated `output/shared/MINDFRAME.md` checkpoint section
3. [ ] Updated `.cursorrules` session end section
4. [ ] Created `prompts/agents/MEMORY_FORMAT.md` (reference doc)
5. [ ] Created CLI Agent task for script update

---

## Next Agent

After completing documentation updates, hand off to CLI Agent:

```
Next Agent: CLI Agent
```
Update scripts/checkpoint.sh to support tiered checkpoints (light/standard/full).
Read output/agents/cli/inbox/UPDATE-CHECKPOINT-SCRIPT.txt for implementation details.
```
```

