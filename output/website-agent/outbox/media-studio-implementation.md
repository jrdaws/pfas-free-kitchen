# Media Studio Implementation Plan

> **Status**: In Progress
> **Date**: 2026-01-05
> **Agent**: Website Agent

---

## Implementation Summary

### Completed This Session

1. âœ… Reviewed existing Media Studio implementation
2. âœ… Created `/api/media/generate` route with Replicate integration
3. âœ… Created `/api/media/status/[jobId]` route for polling
4. âœ… Updated `GenerationProgress.tsx` to use real API with simulation fallback
5. âœ… Created design documentation

### API Implementation Details

#### `/api/media/generate` (POST)

**Features:**
- Accepts batch of assets with prompts
- Creates async job with unique ID
- Supports Flux, Stable Diffusion, and DALL-E (mapped to Flux)
- In-memory job storage with 1-hour TTL
- Returns immediately with job ID for polling

**Models Supported:**
| Model | Replicate Model | Cost |
|-------|-----------------|------|
| flux | `black-forest-labs/flux-schnell` | $0.03 |
| stable-diffusion | `stability-ai/sdxl` | $0.02 |
| dall-e-3 | `black-forest-labs/flux-dev` | $0.08 |

#### `/api/media/status/[jobId]` (GET)

**Returns:**
- Job status (pending/processing/complete/failed)
- Per-asset status and progress
- Image URLs when complete

---

## Phased Rollout

### Phase 1: Core Generation (âœ… Complete)
- [x] API routes created
- [x] Replicate integration
- [x] Fallback simulation mode
- [x] Progress polling

### Phase 2: Asset Library (ðŸ”„ Pending)
- [ ] Create `/api/media/library` route
- [ ] Create `AssetLibrary.tsx` component
- [ ] Supabase storage for approved assets
- [ ] Search and filter capabilities

### Phase 3: Export Integration (ðŸ”„ Pending)
- [ ] Add approved assets to export ZIP
- [ ] Update component references in generated code
- [ ] Image optimization during export

### Phase 4: Enhanced Features (ðŸ”„ Future)
- [ ] Side-by-side comparison view
- [ ] Reference image upload (img2img)
- [ ] Style consistency enforcement
- [ ] Batch variations

---

## Environment Requirements

```env
# Required for real generation
REPLICATE_API_TOKEN=r8_xxx...

# Optional: OpenAI for DALL-E (not yet implemented)
OPENAI_API_KEY=sk-xxx...
```

---

## Testing Instructions

### 1. Test with Simulation (No API Key)

```bash
cd website
npm run dev
# Navigate to /media-studio
# Generation will use placeholder images
```

### 2. Test with Real Generation

```bash
# Add to .env.local
REPLICATE_API_TOKEN=your_key_here

cd website
npm run dev
# Navigate to /media-studio
# Real images will be generated via Replicate
```

---

## Cost Estimates

| Project Size | Assets | Est. Cost |
|--------------|--------|-----------|
| Small (Landing) | 5-10 | $0.15-0.30 |
| Medium (SaaS) | 15-25 | $0.45-0.75 |
| Large (E-commerce) | 30-50 | $0.90-1.50 |

**Note:** Using Flux Schnell for all assets. DALL-E would be 3-4x more expensive.

---

## Files Changed/Created

### New Files
- `app/api/media/generate/route.ts`
- `app/api/media/status/[jobId]/route.ts`
- `output/website-agent/outbox/media-studio-design.md`
- `output/website-agent/outbox/media-studio-implementation.md`

### Modified Files
- `app/components/media-studio/GenerationProgress.tsx` (real API integration)

### Pre-existing (No Changes Needed)
- `app/media-studio/page.tsx`
- `app/components/media-studio/AssetPlannerForm.tsx`
- `app/components/media-studio/PromptBuilder.tsx`
- `app/components/media-studio/QualityReviewer.tsx`
- `app/components/media-studio/MediaStudioStepIndicator.tsx`
- `lib/media-studio-state.ts`
- `lib/prompt-templates.ts`

---

## Handoff Notes

### For Platform Agent (if needed)
- Asset Library API needs database integration
- Consider Redis for job storage in production
- Webhook support for long-running jobs

### For Testing Agent
- Unit tests for prompt composition
- Integration tests for API routes
- E2E test for full generation flow

### For Documentation Agent
- User guide for Media Studio
- Prompt engineering best practices
- Cost optimization tips

---

## Success Criteria Met

- [x] End-to-end pipeline documented
- [x] GUI components reviewed and verified
- [x] API routes implemented with Replicate
- [x] Fallback simulation mode works
- [x] Cost tracking implemented
- [x] Design document created
- [x] Implementation plan created

---

*Document generated by Website Agent*

