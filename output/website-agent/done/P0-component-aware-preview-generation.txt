# P0: Component-Aware AI Preview Generation

**Priority**: P0 - CRITICAL (upgrades P1-premium-preview-quality.txt)
**Date**: 2025-12-24
**From**: Quality Agent

---

## Concept

Instead of AI generating raw HTML from scratch (which looks primitive), we should:

1. **Provide AI with our existing components** as building blocks
2. **Pass user configuration** (template, integrations, inspiration, vision) as context
3. **AI composes and customizes** these components with user's specific content
4. **Result**: Polished preview that looks exactly like the final export

---

## Why This Works Better

| Approach | Quality | Speed | Consistency |
|----------|---------|-------|-------------|
| AI generates raw HTML | ❌ Primitive | ✅ Fast | ❌ Unpredictable |
| Static template preview | ✅ Polished | ✅ Fast | ❌ Not customized |
| **Component-aware AI** | ✅ Polished | ✅ Fast | ✅ Consistent + Customized |

---

## Architecture

### Step 1: Create Component Registry

Define all available preview components the AI can use:

```typescript
// website/lib/preview/component-registry.ts

export const COMPONENT_REGISTRY = {
  // Layout Components
  'Nav': {
    import: '@/components/preview/Nav',
    props: ['projectName', 'links', 'showAuth'],
    description: 'Top navigation bar with logo, links, and auth buttons'
  },
  'Hero': {
    import: '@/components/preview/Hero',
    props: ['title', 'subtitle', 'ctaText', 'ctaLink', 'backgroundStyle'],
    description: 'Hero section with headline, subtext, and CTA button'
  },
  'ProductGrid': {
    import: '@/components/preview/ProductGrid',
    props: ['products', 'columns', 'showPrices', 'showAddToCart'],
    description: 'Grid of product cards for e-commerce'
  },
  'FeatureCards': {
    import: '@/components/preview/FeatureCards',
    props: ['features', 'columns', 'iconStyle'],
    description: 'Feature/benefit cards with icons'
  },
  'PricingTable': {
    import: '@/components/preview/PricingTable',
    props: ['plans', 'showToggle', 'highlightPlan'],
    description: 'Pricing comparison table'
  },
  'Testimonials': {
    import: '@/components/preview/Testimonials',
    props: ['testimonials', 'layout'],
    description: 'Customer testimonials section'
  },
  'Footer': {
    import: '@/components/preview/Footer',
    props: ['projectName', 'links', 'showSocial'],
    description: 'Site footer with links'
  },
  // ... more components
};
```

### Step 2: Create Template Compositions

Define what components each template uses:

```typescript
// website/lib/preview/template-compositions.ts

export const TEMPLATE_COMPOSITIONS = {
  'ecommerce': {
    name: 'E-commerce',
    sections: [
      { component: 'Nav', required: true },
      { component: 'Hero', required: true },
      { component: 'ProductGrid', required: true },
      { component: 'FeatureCards', required: false },
      { component: 'Testimonials', required: false },
      { component: 'Footer', required: true }
    ],
    defaultProps: {
      Hero: {
        backgroundStyle: 'gradient',
        ctaText: 'Shop Now'
      },
      ProductGrid: {
        columns: 4,
        showPrices: true,
        showAddToCart: true
      }
    }
  },
  'saas': {
    name: 'SaaS',
    sections: [
      { component: 'Nav', required: true },
      { component: 'Hero', required: true },
      { component: 'FeatureCards', required: true },
      { component: 'PricingTable', required: true },
      { component: 'Testimonials', required: false },
      { component: 'Footer', required: true }
    ],
    defaultProps: {
      Hero: {
        backgroundStyle: 'mesh',
        ctaText: 'Get Started Free'
      },
      PricingTable: {
        showToggle: true,
        highlightPlan: 'pro'
      }
    }
  }
  // ... more templates
};
```

### Step 3: AI Customization Prompt

The AI receives components + user context and outputs customized props:

```typescript
// website/lib/ai/preview-generator.ts

export async function generatePreviewConfig(userConfig: ConfigState) {
  const template = TEMPLATE_COMPOSITIONS[userConfig.template];
  const components = template.sections.map(s => COMPONENT_REGISTRY[s.component]);
  
  const prompt = `
You are customizing a ${template.name} website preview.

## User Context
- Project Name: ${userConfig.projectName}
- Vision: ${userConfig.vision}
- Inspiration: ${userConfig.inspiration}
- Description: ${userConfig.description}

## Available Components
${components.map(c => `
### ${c.name}
${c.description}
Props: ${c.props.join(', ')}
`).join('\n')}

## Task
Generate props for each component based on the user's context.
Return JSON matching this structure:

{
  "Nav": {
    "projectName": "${userConfig.projectName}",
    "links": ["Products", "Categories", "About"],
    "showAuth": true
  },
  "Hero": {
    "title": "// Generate based on vision/description",
    "subtitle": "// Generate based on inspiration",
    "ctaText": "Shop Now"
  },
  "ProductGrid": {
    "products": [
      { "name": "// Generate based on description", "price": 49.99 },
      { "name": "// Generate based on description", "price": 29.99 },
      // ... 4 products
    ]
  }
}

IMPORTANT: 
- Use the user's description to generate relevant product names
- Match the tone of their vision statement
- Reference their inspiration site's style if mentioned
`;

  const response = await ai.complete(prompt);
  return JSON.parse(response);
}
```

### Step 4: Render With Real Components

The preview renderer uses actual components with AI-generated props:

```tsx
// website/components/preview/PreviewRenderer.tsx

import { Nav } from './components/Nav';
import { Hero } from './components/Hero';
import { ProductGrid } from './components/ProductGrid';
// ... imports

const COMPONENT_MAP = {
  Nav, Hero, ProductGrid, FeatureCards, PricingTable, Testimonials, Footer
};

export function PreviewRenderer({ 
  template, 
  aiConfig 
}: { 
  template: string;
  aiConfig: Record<string, any>;
}) {
  const composition = TEMPLATE_COMPOSITIONS[template];
  
  return (
    <div className="min-h-screen bg-[#0A0A0A]">
      {composition.sections.map(section => {
        const Component = COMPONENT_MAP[section.component];
        const props = {
          ...composition.defaultProps[section.component],
          ...aiConfig[section.component]
        };
        
        return <Component key={section.component} {...props} />;
      })}
    </div>
  );
}
```

---

## Example Flow

### User Configures:
- Template: E-commerce
- Project Name: "PlantHaus"
- Vision: "To become the go-to plant store online for plant lovers"
- Description: "A service that connects people with rare houseplants"
- Inspiration: lowes.com

### AI Receives:
```json
{
  "template": "ecommerce",
  "projectName": "PlantHaus",
  "vision": "To become the go-to plant store online for plant lovers",
  "description": "A service that connects people with rare houseplants",
  "inspiration": "lowes.com"
}
```

### AI Generates Props:
```json
{
  "Nav": {
    "projectName": "PlantHaus",
    "links": ["Shop Plants", "Care Guides", "About Us"],
    "showAuth": true
  },
  "Hero": {
    "title": "Rare Houseplants Delivered to Your Door",
    "subtitle": "Discover unique plants curated for true plant lovers",
    "ctaText": "Shop Collection",
    "backgroundStyle": "gradient"
  },
  "ProductGrid": {
    "products": [
      { "name": "Monstera Albo", "price": 149.99, "category": "Rare" },
      { "name": "Pink Princess Philodendron", "price": 89.99, "category": "Trending" },
      { "name": "Variegated String of Hearts", "price": 34.99, "category": "New" },
      { "name": "Blue Star Fern", "price": 24.99, "category": "Easy Care" }
    ],
    "columns": 4,
    "showPrices": true,
    "showAddToCart": true
  },
  "Footer": {
    "projectName": "PlantHaus",
    "links": ["Shop", "Care Guides", "Contact", "FAQ"],
    "showSocial": true
  }
}
```

### Preview Renders:
- Uses REAL polished components (dark theme, indigo accents)
- With AI-customized content (plant-specific products, relevant copy)
- Looks EXACTLY like the final export would

---

## Benefits

| Benefit | Description |
|---------|-------------|
| **Consistent Quality** | Uses proven, polished components |
| **Customized Content** | AI generates relevant text/products based on user's vision |
| **Fast Generation** | AI only generates props, not entire UI |
| **Preview = Export** | Same components used in export, so WYSIWYG |
| **Design System Enforced** | Components already use correct colors/styling |
| **Easy to Update** | Change a component, all previews improve |

---

## Integration with Export

When user exports, we use the SAME component props:

```typescript
// website/lib/export/generate-pages.ts

export function generatePages(template: string, aiConfig: Record<string, any>) {
  const composition = TEMPLATE_COMPOSITIONS[template];
  
  // Generate page.tsx that imports and uses components with saved props
  const pageCode = `
import { Nav } from '@/components/Nav';
import { Hero } from '@/components/Hero';
import { ProductGrid } from '@/components/ProductGrid';

export default function Home() {
  return (
    <main>
      <Nav ${propsToJsx(aiConfig.Nav)} />
      <Hero ${propsToJsx(aiConfig.Hero)} />
      <ProductGrid ${propsToJsx(aiConfig.ProductGrid)} />
    </main>
  );
}
`;
  
  return pageCode;
}
```

This ensures **Preview = Export**. What users see is exactly what they get.

---

## Files to Create/Modify

### New Files
- `website/lib/preview/component-registry.ts` - Component definitions
- `website/lib/preview/template-compositions.ts` - Template structures
- `website/lib/ai/preview-generator.ts` - AI customization prompt
- `website/components/preview/PreviewRenderer.tsx` - Preview renderer
- `website/components/preview/components/` - Polished preview components

### Modify
- `website/app/configure/steps/PreviewStep.tsx` - Use new preview system
- `website/lib/export/` - Use same props for export

---

## Acceptance Criteria

- [ ] AI receives user config and available components as context
- [ ] AI outputs customized props, NOT raw HTML
- [ ] Preview renders using real polished components
- [ ] Content is personalized (project name, relevant products, matching copy)
- [ ] Preview looks identical to final export
- [ ] Same component props used for both preview and export

---

## Priority Upgrade

This supersedes `P1-premium-preview-quality.txt` and becomes P0 because:
1. Solves preview quality AND export mismatch simultaneously
2. Creates sustainable architecture (components used everywhere)
3. Enables true "What You See Is What You Get"
4. Reduces AI complexity (props only, not full code generation)

---

*P0 Architecture | Quality Agent → Website Agent | 2025-12-24*

